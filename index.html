<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Missing Number</title>

    <!-- –ò–∫–æ–Ω–∫–∞ -->
    <link rel="icon" type="image/svg+xml" href="./favicon.svg" />

    <!-- –®—Ä–∏—Ñ—Ç—ã -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600&family=Montserrat:wght@400;600&display=swap"
      rel="stylesheet"
    />

    <!-- –°—Ç–∏–ª–∏ -->
    <link rel="stylesheet" href="./styles.css" />
    <!-- CSS –¥–ª—è —Ç—Ä–µ–Ω–∞–∂—ë—Ä–∞ —É—Ä–∞–≤–Ω–µ–Ω–∏–π –≤–Ω–µ–¥—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ JavaScript -->
  </head>

  <body class="game-screen">
    <header class="app-header">
      <div class="app-header__brand">
        <img
          src="./assets/logo.png"
          alt="Missing Number logo"
          class="app-header__logo"
        />

        <div class="app-header__titles">
          <h1 id="appTitle" class="app-header__title">
            <span class="title-main">Missing Number</span>
            <span class="title-sub">–ó–Ω–∞–π–¥–∏ –ø—Ä–æ–ø—É—â–µ–Ω–µ —á–∏—Å–ª–æ –≤ —Ä—ñ–≤–Ω—è–Ω–Ω—è—Ö</span>
          </h1>
          <h2 id="appTagline" class="app-header__tagline">
            –¢—Ä–µ–Ω–∞–∂–µ—Ä —Ä—ñ–≤–Ω—è–Ω—å –∑ –æ–¥–Ω–∏–º –Ω–µ–≤—ñ–¥–æ–º–∏–º
          </h2>
        </div>
      </div>

      <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–æ–≤ -->
      <div id="languageSwitcher" class="app-header__languages"></div>
    </header>

    <main id="app" class="app-main" role="main"></main>

    <footer id="appFooter" class="app-footer">MindWorld School ¬© 2025</footer>

    <!-- –î–µ—Ç–µ–∫—Ç–æ—Ä —è–∑—ã–∫–∞ -->
    <script>
      (function () {
        const SUPPORTED_LANGS = ["ua", "en", "ru", "es"];
        const params = new URLSearchParams(window.location.search);
        let lang = params.get("lang");

        // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä lang –≤ URL
        if (!SUPPORTED_LANGS.includes(lang)) {
          // 2. –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –ø—Ä–æ–±—É–µ–º –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ referrer
          const referrer = document.referrer;
          if (referrer) {
            if (referrer.includes("/en/")) {
              lang = "en";
            } else if (referrer.includes("/ru/")) {
              lang = "ru";
            } else if (referrer.includes("/es/")) {
              lang = "es";
            } else if (referrer.includes("mindworldschool.com")) {
              // –£–∫—Ä–∞–∏–Ω—Å–∫–∞—è –≤–µ—Ä—Å–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–º –¥–æ–º–µ–Ω–µ –±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞
              lang = "ua";
            }
          }

          // 3. –ï—Å–ª–∏ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–∏–ª–∏ ‚Äî –ø—Ä–æ–±—É–µ–º –≤–∑—è—Ç—å –∏–∑ localStorage
          if (!SUPPORTED_LANGS.includes(lang)) {
            const saved = localStorage.getItem("mws_lang");
            if (SUPPORTED_LANGS.includes(saved)) {
              lang = saved;
            } else {
              // 4. –Ø–∑—ã–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
              lang = "ua";
            }
          }
        }

        // 5. –°–æ—Ö—Ä–∞–Ω—è–µ–º —è–∑—ã–∫
        localStorage.setItem("mws_lang", lang);

        // 6. –ü–µ—Ä–µ–¥–∞—ë–º —è–∑—ã–∫ –≤ main.js
        window.APP_LANG = lang;

        // 7. –û–±–Ω–æ–≤–ª—è–µ–º lang –≤ <html>
        const langMap = { ua: "uk", en: "en", ru: "ru", es: "es" };
        document.documentElement.lang = langMap[lang] || "uk";
      })();
    </script>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π JS -->
    <script type="module" src="./app.js"></script>
    <!-- –í –∫–æ–Ω—Ü–µ body, –ø–µ—Ä–µ–¥ </body> -->
<button id="saveAsHomework" style="
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: linear-gradient(135deg, #ff7c00 0%, #ff9d40 100%);
    color: white;
    padding: 15px 30px;
    border: none;
    border-radius: 15px;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(255, 124, 0, 0.3);
    z-index: 10000;
    font-size: 16px;
    font-family: Arial, sans-serif;
">
    üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ –î–ó
</button>

<script>
document.getElementById('saveAsHomework').addEventListener('click', function() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –æ—Ç–∫—Ä—ã—Ç—ã –∏–∑ LMS
    if (window.opener) {
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π URL —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
        window.opener.postMessage({
            type: 'TRAINER_SETTINGS_SAVED',
            url: window.location.href,
            trainer: 'Mind Abacus' // –ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–Ω–∞–∂–µ—Ä–∞
        }, '*');
        
        alert('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã! –ó–∞–∫—Ä—ã–≤–∞—é –æ–∫–Ω–æ...');
        setTimeout(() => window.close(), 1000);
    } else {
        alert('‚ö†Ô∏è –≠—Ç–∞ –∫–Ω–æ–ø–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –î–ó –∏–∑ LMS');
    }
});
</script>
  </body>
</html>
