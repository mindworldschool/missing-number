<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Missing Number</title>

    <!-- –ò–∫–æ–Ω–∫–∞ -->
    <link rel="icon" type="image/svg+xml" href="./favicon.svg" />

    <!-- –®—Ä–∏—Ñ—Ç—ã -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600&family=Montserrat:wght@400;600&display=swap"
      rel="stylesheet"
    />

    <!-- –°—Ç–∏–ª–∏ -->
    <link rel="stylesheet" href="./styles.css" />
    <!-- CSS –¥–ª—è —Ç—Ä–µ–Ω–∞–∂—ë—Ä–∞ —É—Ä–∞–≤–Ω–µ–Ω–∏–π –≤–Ω–µ–¥—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ JavaScript -->
  </head>

  <body class="game-screen">
    <header class="app-header">
      <div class="app-header__brand">
        <img
          src="./assets/logo.png"
          alt="Missing Number logo"
          class="app-header__logo"
        />

        <div class="app-header__titles">
          <h1 id="appTitle" class="app-header__title">
            <span class="title-main">Missing Number</span>
            <span class="title-sub">–ó–Ω–∞–π–¥–∏ –ø—Ä–æ–ø—É—â–µ–Ω–µ —á–∏—Å–ª–æ –≤ —Ä—ñ–≤–Ω—è–Ω–Ω—è—Ö</span>
          </h1>
          <h2 id="appTagline" class="app-header__tagline">
            –¢—Ä–µ–Ω–∞–∂–µ—Ä —Ä—ñ–≤–Ω—è–Ω—å –∑ –æ–¥–Ω–∏–º –Ω–µ–≤—ñ–¥–æ–º–∏–º
          </h2>
        </div>
      </div>

      <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–æ–≤ -->
      <div id="languageSwitcher" class="app-header__languages"></div>
    </header>

    <main id="app" class="app-main" role="main"></main>

    <footer id="appFooter" class="app-footer">MindWorld School ¬© 2025</footer>

    <!-- –î–µ—Ç–µ–∫—Ç–æ—Ä —è–∑—ã–∫–∞ -->
    <script>
      (function () {
        const SUPPORTED_LANGS = ["ua", "en", "ru", "es"];
        const params = new URLSearchParams(window.location.search);
        let lang = params.get("lang");

        // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä lang –≤ URL
        if (!SUPPORTED_LANGS.includes(lang)) {
          // 2. –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –ø—Ä–æ–±—É–µ–º –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ referrer
          const referrer = document.referrer;
          if (referrer) {
            if (referrer.includes("/en/")) {
              lang = "en";
            } else if (referrer.includes("/ru/")) {
              lang = "ru";
            } else if (referrer.includes("/es/")) {
              lang = "es";
            } else if (referrer.includes("mindworldschool.com")) {
              // –£–∫—Ä–∞–∏–Ω—Å–∫–∞—è –≤–µ—Ä—Å–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–º –¥–æ–º–µ–Ω–µ –±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞
              lang = "ua";
            }
          }

          // 3. –ï—Å–ª–∏ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–∏–ª–∏ ‚Äî –ø—Ä–æ–±—É–µ–º –≤–∑—è—Ç—å –∏–∑ localStorage
          if (!SUPPORTED_LANGS.includes(lang)) {
            const saved = localStorage.getItem("mws_lang");
            if (SUPPORTED_LANGS.includes(saved)) {
              lang = saved;
            } else {
              // 4. –Ø–∑—ã–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
              lang = "ua";
            }
          }
        }

        // 5. –°–æ—Ö—Ä–∞–Ω—è–µ–º —è–∑—ã–∫
        localStorage.setItem("mws_lang", lang);

        // 6. –ü–µ—Ä–µ–¥–∞—ë–º —è–∑—ã–∫ –≤ main.js
        window.APP_LANG = lang;

        // 7. –û–±–Ω–æ–≤–ª—è–µ–º lang –≤ <html>
        const langMap = { ua: "uk", en: "en", ru: "ru", es: "es" };
        document.documentElement.lang = langMap[lang] || "uk";
      })();
    </script>

   <button id="saveAsHomeworkBtn" style="position:fixed; bottom:20px; right:20px; background:linear-gradient(135deg, #FF7C00 0%, #FF9D40 100%); color:white; padding:15px 25px; border:none; border-radius:15px; font-weight:bold; cursor:pointer; box-shadow:0 4px 15px rgba(255,124,0,0.3); z-index:99999; font-size:16px; display:none;">
    üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ —è–∫ –î–ó
</button>
<script>
if (window.opener) { document.getElementById('saveAsHomeworkBtn').style.display = 'block'; }
document.getElementById('saveAsHomeworkBtn').addEventListener('click', function() {
    if (window.opener) {
        window.opener.postMessage({ type: 'TRAINER_SETTINGS_SAVED', url: window.location.href }, '*');
        alert('‚úÖ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–±–µ—Ä–µ–∂–µ–Ω–æ! –¢–µ–ø–µ—Ä –∑–∞–∫—Ä–∏–π—Ç–µ —Ü–µ –≤—ñ–∫–Ω–æ.');
    }
});
</script>
  </body>
</html>
